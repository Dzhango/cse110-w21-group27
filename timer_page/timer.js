let currentTaskId,allTasks,distractCounter=0,isFailed=!1,isInSession=!1,isReload=!0;const circle=document.querySelector(".progress-ring-circle"),radius=circle.r.baseVal.value,circumference=2*radius*Math.PI;circle.style.strokeDasharray=circumference,circle.style.strokeDashoffset=0;function setProgress(a){circle.style.strokeDashoffset=-(a/100*circumference)}function resetProgressRing(){circle.style.strokeDashoffset=0}function displayBreakComplete(){const a=new Audio("../media/break-tune.mp3");a.play(),document.getElementById("breakCompleteModal").style.display="block"}function continueTask(){document.getElementById("breakCompleteModal").style.display="none",document.body.style.backgroundImage="linear-gradient(to right,#E0EAFC,#CFDEF3)",document.getElementById("currTask").innerHTML="Task",document.getElementById("button-container").style.display="flex",document.getElementById("start-btn").style.display="block",document.getElementById("button-container").style.paddingLeft="0px",resetProgressRing(),document.getElementById("distraction-btn").innerHTML=`Distraction : ${distractCounter}`,document.getElementById("title_timer").innerHTML="01:00 - Time To Work!",document.getElementById("minutes").innerHTML="01",document.getElementById("seconds").innerHTML="00",document.getElementById("currTask").innerHTML=allTasks[currentTaskId].name}function changeTask(){document.getElementById("breakCompleteModal").style.display="none",window.location.href="../index.html"}function displayShortBreak(){const a=new Audio("../media/work-tune.mp3");a.play(),setTimeout(()=>{resetProgressRing(),document.body.style.backgroundImage="linear-gradient(to right,#74EBD5,#ACB6E5)",document.getElementById("minutes").innerHTML="01",document.getElementById("seconds").innerHTML="00",document.getElementById("currTask").innerHTML="Short Break",document.getElementById("button-container").style.display="none",document.getElementById("container-short").style.display="block"},2e3)}function startShortBreak(){document.getElementById("container-short").style.display="none",start(0,3)}function displayLongBreak(){const a=new Audio("../media/work-tune.mp3");a.play(),setTimeout(()=>{resetProgressRing(),document.body.style.backgroundImage="linear-gradient(to right,#ACB6E5,#74EBD5)",document.getElementById("minutes").innerHTML="01",document.getElementById("seconds").innerHTML="00",document.getElementById("currTask").innerHTML="Long Break",document.getElementById("button-container").style.display="none",document.getElementById("container-long").style.display="block"},2e3)}function startLongBreak(){document.getElementById("container-long").style.display="none",start(0,5)}function startTimer(){document.getElementById("distraction-btn").disabled=!1,isFailed=!0,document.getElementById("start-btn").style.display="none",document.getElementById("button-container").style.paddingLeft="150px",start(0,3)}window.onload=function(){document.getElementById("start-btn").addEventListener("click",startTimer),document.getElementById("distraction-btn").addEventListener("click",distractionCount),document.getElementById("fail-btn").addEventListener("click",displayFailModal),document.getElementById("start-short-btn").addEventListener("click",startShortBreak),document.getElementById("start-long-btn").addEventListener("click",startLongBreak),document.getElementById("continue-btn").addEventListener("click",continueTask),document.getElementById("change-btn").addEventListener("click",changeTask),document.getElementById("fail-button").addEventListener("click",failSession),document.getElementById("cancel-button").addEventListener("click",quitFailModal);const a=JSON.parse(localStorage.getItem("currentTask"));allTasks=JSON.parse(localStorage.getItem("allTasks"));for(let b=0;b<allTasks.length;b++)allTasks[b].id===a&&(currentTaskId=b,document.getElementById("currTask").innerHTML=allTasks[currentTaskId].name);resetProgressRing(),"true"===localStorage.getItem("ShortBreak")?(document.body.style.backgroundImage="linear-gradient(to right,#74EBD5,#ACB6E5)",document.getElementById("minutes").innerHTML="01",document.getElementById("seconds").innerHTML="00",document.getElementById("currTask").innerHTML="Short Break",document.getElementById("button-container").style.display="none",document.getElementById("container-short").style.display="block"):"true"===localStorage.getItem("LongBreak")?(document.body.style.backgroundImage="linear-gradient(to right,#ACB6E5,#74EBD5)",document.getElementById("minutes").innerHTML="01",document.getElementById("seconds").innerHTML="00",document.getElementById("currTask").innerHTML="Long Break",document.getElementById("button-container").style.display="none",document.getElementById("container-long").style.display="block"):(localStorage.setItem("isPomo","false"),document.getElementById("minutes").innerHTML="01",document.getElementById("seconds").innerHTML="00",document.getElementById("distraction-btn").innerHTML=`Distraction : ${distractCounter}`,document.getElementById("title_timer").innerHTML="01:00 - Time To Work!",document.getElementById("start-btn").style.display="block",document.getElementById("button-container").style.paddingLeft="0px"),window.history.pushState(null,document.title,window.location.href),window.addEventListener("popstate",()=>{isFailed?displayFailModal():window.history.back()})};function start(a,b){function c(){var a=Math.floor;document.getElementById("header").isNewCycle="false";const b=+new Date,c=a((b-f)/1e3),i=g-c;d=a(i/60),e=i%60;if(setProgress(100-100*(i/g)),document.getElementById("minutes").innerHTML=10>d?`0${d}`:d,!(10>e))document.getElementById("seconds").innerHTML=e,document.getElementById("title_timer").innerHTML=`${d}:${e}`;else if(document.getElementById("seconds").innerHTML=`0${e}`,document.getElementById("title_timer").innerHTML=`${d}:0${e}`,0===e&&0>=d){clearInterval(h);let a=+localStorage.getItem("sessionCounter");a+=1;const b=localStorage.getItem("isPomo");isInSession=!1,document.getElementById("distraction-btn").disabled=!0,"true"===b?(localStorage.setItem("isPomo","false"),"true"===localStorage.getItem("LongBreak")&&(document.getElementById("header").isNewCycle="true"),localStorage.setItem("ShortBreak","false"),localStorage.setItem("LongBreak","false"),displayBreakComplete()):(localStorage.setItem("isPomo","true"),document.getElementById("failModal").style.display="none",isFailed=!1,0==a%4?(document.getElementById("header").completedCycles=a,localStorage.setItem("sessionCounter",a),localStorage.setItem("LongBreak","true"),localStorage.setItem("ShortBreak","false"),displayLongBreak()):(document.getElementById("header").completedCycles=a,localStorage.setItem("sessionCounter",a),localStorage.setItem("ShortBreak","true"),localStorage.setItem("LongBreak","false"),displayShortBreak()),allTasks[currentTaskId].current+=1,localStorage.setItem("allTasks",JSON.stringify(allTasks)))}}let d=a,e=b;isInSession=!0;const f=+new Date;distractCounter=0,document.getElementById("distraction-btn").innerHTML=`Distraction : ${distractCounter}`;const g=60*d+e;document.getElementById("minutes").innerHTML=10>d?`0${d}`:d,10>e?(document.getElementById("seconds").innerHTML=`0${e}`,document.getElementById("title_timer").innerHTML=`${d}:0${e}`):(document.getElementById("seconds").innerHTML=e,document.getElementById("title_timer").innerHTML=`${d}:${e}`);const h=setInterval(c,500)}function distractionCount(){distractCounter+=1,document.getElementById("distraction-btn").innerHTML=`Distraction : ${distractCounter}`}function displayFailModal(){isReload=!1,document.getElementById("failModal").style.display="block"}function failSession(){document.getElementById("failModal").style.display="none",window.location.href="../index.html"}function quitFailModal(){isReload=!0,window.history.pushState(null,document.title,window.location.href),document.getElementById("failModal").style.display="none"}window.onbeforeunload=function(){if(isInSession&&isReload)return"Your timer progress will reset"};