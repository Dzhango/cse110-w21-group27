class TaskList extends HTMLElement{constructor(){super();const a=this.attachShadow({mode:"open"});this.allTasks=null,this.dropzone=null,this.checked=!1,this.selectedNode=null,this.nodes=null,this.preNodePos=null,a.innerHTML=`<link rel="stylesheet" href="task.css"/>
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous"/>`}connectedCallback(){localStorage.setItem("ShortBreak","false"),localStorage.setItem("LongBreak","false"),document.getElementById("taskform").addEventListener("submit",a=>this.addTask(a));const a=document.createElement("ul");a.setAttribute("id","main-list"),a.setAttribute("class","task-container d-flex"),this.shadowRoot.append(a);const b=localStorage.getItem("allTasks");if(!b||"undefined"===b)this.allTasks=[];else{this.allTasks=JSON.parse(b),0!==this.allTasks.length&&document.getElementById("welcome-message").remove();for(let a=0;a<this.allTasks.length;a++)this.renderTask(this.allTasks[a])}this.dropzone=this.shadowRoot.querySelector("ul"),this.nodes=this.dropzone.getElementsByClassName("taskNode"),this.selectedNode=null,this.preNodePos=0,this.checked=!1,this.dropzone.addEventListener("dragstart",a=>this.handleDragStart(a),!1),this.dropzone.addEventListener("dragover",a=>this.handleDragOver(a))}disconnectedCallback(){localStorage.setItem("allTasks",JSON.stringify(this.allTasks))}renderTask(a){const b=document.createElement("task-item");b.setAttribute("id",a.id),b.name=a.name,b.current=a.current,b.number=a.number,b.completed=a.completed,b.setFunctions(this.playTask.bind(this),this.deleteTask.bind(this),this.editTask.bind(this),this.setCheck.bind(this)),this.shadowRoot.querySelector("ul").appendChild(b)}addTask(a){a.preventDefault();const b={id:Math.random().toString(16).slice(2),completed:!1,name:document.getElementById("task-name").value,number:document.getElementById("task-num").value,current:0,note:document.getElementById("task-note").value};this.allTasks.push(b),this.renderTask(b),document.getElementById("taskform").reset();const c=document.getElementById("welcome-message");c&&c.remove(),document.getElementById("add-task-modal").style.display="none"}deleteTask(a){document.getElementById("delete-modal").style.display="block";const b=a.target,c=b.getRootNode().host,{name:d}=c;document.getElementById("task-delete").innerText=`${d}?`,document.getElementById("confirm-button").addEventListener("click",()=>{for(let a=0;a<this.allTasks.length;a++)if(this.allTasks[a].name===d){this.allTasks.splice(a,1);break}c.remove(),document.getElementById("delete-modal").style.display="none"})}editTask(a){const b=a.target.getRootNode().host,c=b.id,d=this.allTasks.findIndex(a=>a.id===c);document.getElementById("edit-note").value=this.allTasks[d].note,document.getElementById("edit-name").value=b.name,document.getElementById("edit-num").value=b.number;const e=document.getElementById("edit-modal");e.style.display="block",document.getElementById("editform").addEventListener("submit",a=>{a.preventDefault();const c=document.getElementById("edit-name").value,f=document.getElementById("edit-num").value,g=document.getElementById("edit-note").value;b.name=c,b.number=f,this.allTasks[d].name=c,this.allTasks[d].number=f,this.allTasks[d].note=g,e.style.display="none"},{once:!0})}setCheck(a){const b=a.target.getRootNode().host,c=b.id;b.completed="true"===b.completed?"false":"true";const d=this.allTasks.findIndex(a=>a.id===c);this.allTasks[d].completed=!this.allTasks[d].completed}playTask(a){document.getElementById("play-modal").style.display="block";const b=a.target.getRootNode().host;document.getElementById("timer-name").innerText=b.name;const c=this.allTasks.findIndex(a=>a.id===b.id);document.getElementById("timer-note").innerText=this.allTasks[c].note;const d=b.id;localStorage.setItem("currentTask",JSON.stringify(d))}handleDragStart(a){this.preNodePos=this.setNodePos(a.clientY),this.selectedNode=a.target,this.checked=this.selectedNode.checkmark.checked}handleDragOver(a){a.preventDefault();const b=this.setNodePos(a.clientY);if(this.preNodePos!==b){this.preNodePos=b,this.dropzone.insertBefore(this.selectedNode,this.dropzone.children[b]),this.selectedNode.checkmark.checked=this.checked;const a=[];for(let b=0;b<this.nodes.length;b++){const c=this.nodes[b].id,d=this.allTasks.find(a=>a.id===c);a.push(d)}this.allTasks=a}}establishNodePositions(){for(let a=0;a<this.nodes.length;a++){const b=this.nodes[a].getBoundingClientRect(),c=b.top,d=b.bottom;this.nodes[a].yPos=c+(d-c)/2}}setNodePos(a){this.establishNodePositions();let b=0;for(let c=0;c<this.nodes.length;c++)this.nodes[c].yPos<a&&(b=c+1);return b}}customElements.define("task-list",TaskList),"undefined"!=typeof exports&&(module.exports={TaskList});